<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>A Quick Intro: Azure Durable Task Framework for Long Running Code-Based Workflows Using async/await and Azure Service Bus | Jon Gallant</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="azure,howto,dev" />
    
    <meta name="description" content="The Durable Task Framework (DTF) is a workflow execution framework that is based on async/await and backed by Azure Service Bus. I was recently in need of a long running workflow engine and wanted to">
<meta property="og:type" content="article">
<meta property="og:title" content="A Quick Intro: Azure Durable Task Framework for Long Running Code-Based Workflows Using async/await and Azure Service Bus">
<meta property="og:url" content="http://blog.jongallant.com/2016/03/durable-task-framework-quick-intro/index.html">
<meta property="og:site_name" content="Jon Gallant">
<meta property="og:description" content="The Durable Task Framework (DTF) is a workflow execution framework that is based on async/await and backed by Azure Service Bus. I was recently in need of a long running workflow engine and wanted to">
<meta property="og:image" content="http://blog.jongallant.com/images/blog/a6f01814a8be_902F/image.png">
<meta property="og:updated_time" content="2016-12-29T03:37:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A Quick Intro: Azure Durable Task Framework for Long Running Code-Based Workflows Using async/await and Azure Service Bus">
<meta name="twitter:description" content="The Durable Task Framework (DTF) is a workflow execution framework that is based on async/await and backed by Azure Service Bus. I was recently in need of a long running workflow engine and wanted to">
<meta name="twitter:image" content="http://blog.jongallant.com/images/blog/a6f01814a8be_902F/image.png">
    

    
        <link rel="alternate" href="http://feeds.feedburner.com/jongallant" title="Jon Gallant" type="application/atom+xml" />
    

    
        <link rel="icon" href="/favicon.ico" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-1148981-8', 'auto');
ga('send', 'pageview');

</script>
    
    

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">tech.leadership.music.coffee</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/">Leadership</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/Career-Model/">Career Model</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/Productivity/">Productivity</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/Review-Model/">Review Model</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/Work-Life-Balance/">Work:Life Balance</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Musings/">Musings</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Reviews/">Reviews</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/">Tech</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/3D-Printing/">3D Printing</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Announcements/">Announcements</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Azure/">Azure</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Bugs/">Bugs</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Career/">Career</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Conferences/">Conferences</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/IoT/">IoT</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Jobs/">Jobs</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Microsoft/">Microsoft</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Power-BI/">Power BI</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Reviews/">Reviews</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Tips/">Tips</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Tutorials/">Tutorials</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/tip/">tip</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/tip/reviews/">reviews</a></li></ul></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/archives/">Archive</a>
                                </li>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/contact/">Contact</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/category/Tech/">Tech</a><i class="icon fa fa-angle-right"></i><a class="page-title-link" href="/category/Tech/Tutorials/">Tutorials</a>
    </h1>
</div>

                        
                        <div class="main-body-content">
                        <div class="banner-ad">
                        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- banner -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7253926757222509"
     data-ad-slot="8838481977"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
                            <article id="post-durable-task-framework-quick-intro" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        A Quick Intro: Azure Durable Task Framework for Long Running Code-Based Workflows Using async/await and Azure Service Bus
        </h1>
    

            </header>
        
        
            <div class="article-subtitle">
                
<a href="/2016/03/durable-task-framework-quick-intro/" class="article-date">
    <time datetime="2016-03-19T22:56:00.000Z" itemprop="datePublished">2016-03-19</time>
</a>

                
    <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/azure/">azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/howto/">howto</a></li></ul>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>The <a href="https://github.com/Azure/durabletask" target="_blank" rel="external">Durable Task Framework</a> (DTF) is a workflow execution framework that is based on async/await and backed by Azure Service Bus. I was recently in need of a long running workflow engine and wanted to take advantage of all the async/await goodness. I looked at a bunch of options, including Windows Workflow Foundation, BizTalk, Logic Apps and WorkflowEngine.net. I haven’t gone too deep into DTF, but from the surface it looks like it is lightweight enough and pretty straight forward with minimal dependencies.</p>
<p>DTF is on GitHub here: <a href="https://github.com/Azure/durabletask" title="https://github.com/Azure/durabletask" target="_blank" rel="external">https://github.com/Azure/durabletask</a></p>
<p>It has two main components: Orchestrations and Tasks. Orchestrations “orchestrate” your application logic and executes custom code inline and calls out to Tasks. Your custom orchestrations are derived from TaskOrchestration&lt;TResult, TInput&gt; and your custom tasks are derived from TaskActivity&lt;TInput, TResult&gt;</p>
<p>To use it as is today, you should either get a release of it <a href="https://github.com/jonbgallant/durabletask/releases" target="_blank" rel="external">here</a> or if you want to build it locally, I recommend that you sync to <a href="https://github.com/Azure/durabletask/pull/32" target="_blank" rel="external">my PR here</a>, or just use <a href="https://github.com/jonbgallant/durabletask/tree/nugetdotnetupdates" target="_blank" rel="external">my fork here</a>, which updates all the NuGet packages to the latest versions and upgrades it to .NET 4.6.1.Once you clone the repo, open up the DurableTaskSamples.sln, build and run unit tests to make sure all is good. Make sure you restore NuGetpackages, right click solution name and click “Restore NuGet Packages”</p>
<p>Here’s a quick walkthrough on how to get it setup.</p>
<h2 id="Setup-Azure"><a href="#Setup-Azure" class="headerlink" title="Setup Azure"></a>Setup Azure</h2><h3 id="Table-Storage"><a href="#Table-Storage" class="headerlink" title="Table Storage"></a>Table Storage</h3><p>1. Go to the new Azure Portal and create a new Storage Account. Click New and then search for “storage account”.</p>
<p><img src="/images/blog/a6f01814a8be_902F/image.png" alt=""></p>
<p>Select “Resource Manager” deployment model</p>
<p><img src="/images/blog/a6f01814a8be_902F/image_3.png" alt=""></p>
<p>Give it a name, select pricing model, subscription, resource group and location.</p>
<p>Get the connection string from the Settings –&gt; Access Keys blade</p>
<p><img src="/images/blog/a6f01814a8be_902F/image_4.png" alt=""></p>
<p>Copy that connection string to the “StorageConnectionString” appSetting in DurableTaskSamples/App.config</p>
<h3 id="Service-Bus"><a href="#Service-Bus" class="headerlink" title="Service Bus"></a>Service Bus</h3><p>Go to the Azure Portal and create a new Service Bus Topic, which has to be done at <a href="http://manage.windowsazure.com" target="_blank" rel="external">http://manage.windowsazure.com</a>, not <a href="http://portal.azure.com" target="_blank" rel="external">http://portal.azure.com</a></p>
<p><img src="/images/blog/a6f01814a8be_902F/image_5.png" alt=""></p>
<p>Grab the connectionstring for that service bus and paste it into “ServiceBusConnectionSTring” appSetting in DurableTaskSamples/App.config</p>
<p>You can also change the taskHubName appSetting if you want to.</p>
<h3 id="Run-DurableTaskSamples"><a href="#Run-DurableTaskSamples" class="headerlink" title="Run DurableTaskSamples"></a>Run DurableTaskSamples</h3><p>Double click on DurableTaskSamples Properties and change the Debug-&gt;Start Options-&gt;Command line arguments to this: “-c –s Greetings”</p>
<p><img src="/images/blog/a6f01814a8be_902F/image_6.png" alt=""></p>
<p>Set a breakpoint in Program.cs, SendGreetingTaks.Execute and GetUserTask.Execute and hit F5.</p>
<p>Step through the code and you should see this:</p>
<p><img src="/images/blog/a6f01814a8be_902F/image_7.png" alt=""></p>
<p>Enter your name and continue to step through the code and you’ll see this.</p>
<p><img src="/images/blog/a6f01814a8be_902F/image_8.png" alt=""></p>
<p>As you can see, for this very simple orchestration “GreetingsOrchestration” there are two called tasks “GetUserTask”, which does the name prompt and “SendGreetingTask”, which writes the greeting to the console.</p>
<p>GreetingsOrchestration derives from TaskOrchestration&lt;string, string&gt; and has a RunTask method that calls GetUserTask and SendGreetingTask.</p>
 <script src="https://gist.github.com/jonbgallant/d77d3edf23cc958626a7.js"></script>   

<p>GetUserTask derives from TaskActivity&lt;string, string&gt; and implements the Execute method</p>
<script src="https://gist.github.com/jonbgallant/20703980400f502b4cce.js"></script>  

<p>SendGreetingTask derives from TaskActivity&lt;string, string&gt; and implements the Excute method</p>
 <script src="https://gist.github.com/jonbgallant/20703980400f502b4cce.js"></script>   

<p>One other thing I noticed is that you can Schedule a task using its namespace like so:</p>
 <script src="https://gist.github.com/jonbgallant/dbdb2e6c62c0b5287449.js"></script>  

<p>That would basically allow you to create data driven workflows that are mapped to TaskActivitys via namespaces. Another thing to note in the above same is the use of “await Task.WhenAny”. This allows you to have conditional forks in your logic.</p>
<p>I’m still learning DTF myself, but so far is looks like a lightweight async task executor that might be a great alternative to Workflow Foundation.</p>
<p>Jon</p>

        </div>
        <footer>
        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

                        </div>
                        <div style="width:64%;margin:auto;" data-type="ad" data-publisher="lqm.jongallant.site" data-format="728x90" data-zone="ros" data-tags="iot%2cangularjs%2cjavascript%2cnode%2cazureiot%2cazure%2cpowerbi%2cseattle%2cdeveloper%2cmicrosoft%2ctutorials"></div>
                    </section>
                    
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2017 Jon Gallant</p>
                <p>Disclaimer: The opinions expressed herein are my own personal opinions and do not represent my employer’s view in any way.</p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'jongallant';
    
    
    var disqus_url = 'http://blog.jongallant.com/2016/03/durable-task-framework-quick-intro/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>



    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>

    <script type='text/javascript'>
function _dmBootstrap(file) {
    var _dma = document.createElement('script');
    _dma.type = 'text/javascript';
    _dma.async = true;
    _dma.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + file;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(_dma);
}
function _dmFollowup(file) { if (typeof DMAds === 'undefined') _dmBootstrap('cdn2.DeveloperMedia.com/a.min.js'); }
(function () { _dmBootstrap('cdn1.DeveloperMedia.com/a.min.js'); setTimeout(_dmFollowup, 2000); })();
</script>
    
</body>
</html>
